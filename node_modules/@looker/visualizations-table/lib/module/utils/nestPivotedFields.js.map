{"version":3,"file":"nestPivotedFields.js","names":["createColumnHelper","nestPivotedFields","pivotList","pivotIndex","nestedPivots","pivotValues","columnHelper","pivot","id","header","name","data","labels","replace","label","group","columns","Array","isArray"],"sources":["../../../src/utils/nestPivotedFields.ts"],"sourcesContent":["/**\n * Copyright (c) 2023 Google LLC\n * SPDX-License-Identifier: MIT\n */\n\nimport type {\n  SDKRecord,\n  Fields,\n  PivotMetadata,\n} from '@looker/visualizations-adapters'\nimport type { ColumnDef } from '@tanstack/table-core'\nimport { createColumnHelper } from '@tanstack/react-table'\n\ntype NestPivotedFieldsProps = {\n  pivotList: Fields['pivots']\n  pivotIndex: number\n  nestedPivots: ColumnDef<SDKRecord> | ColumnDef<SDKRecord>[]\n  pivotValues?: PivotMetadata\n}\n\n/**\n * Recursively nests a list of columns inside columnHelper.group,\n * each recursive level representing a pivoted column.\n * @param {Object} columnGroups - all the metadata required to nest columns nested columnHelper group\n * @param {Array} columnGroups.pivotList - fields.pivots sdk response\n * @param {number} columnGroups.pivotIndex - which pivot from pivotList to format\n * @param {Object} columnGroups.nestedPivots - the accumulated nesting of columnHelper.group functions\n * @param {Object} columnGroups.pivotValues - optional additional pivot header values, used with grouped measures\n * @returns Column groups for use with Tanstack Table\n */\nexport const nestPivotedFields = ({\n  pivotList = [],\n  pivotIndex,\n  nestedPivots,\n  pivotValues,\n}: NestPivotedFieldsProps): ColumnDef<SDKRecord> => {\n  const columnHelper = createColumnHelper<SDKRecord>()\n\n  const pivot = pivotList[pivotIndex]\n  if (pivot) {\n    const { id, header } = pivotValues\n      ? {\n          id: `${pivot.name} - ${pivotValues?.data[pivot.name]}`,\n          // `replace` call use to strip HTML markup that came from the sdk response\n          header: pivotValues?.labels[pivot.name]?.replace(/(<([^>]+)>)/gi, ''),\n        }\n      : { id: pivot.name, header: pivot.label }\n\n    return nestPivotedFields({\n      pivotList,\n      pivotIndex: pivotIndex + 1,\n      nestedPivots: columnHelper.group({\n        id,\n        header,\n        columns: [\n          ...(Array.isArray(nestedPivots) ? nestedPivots : [nestedPivots]),\n        ],\n      }),\n      pivotValues,\n    })\n  }\n\n  // Handles the edge case where an array of measure columns is passed\n  // to this function, but the pivot list is empty. Should never happen,\n  // but case needs to be accounted for per type definitions.\n  if (Array.isArray(nestedPivots)) {\n    return columnHelper.group({\n      id: `pivot-field-${pivotIndex}`,\n      columns: nestedPivots,\n    })\n  }\n\n  return nestedPivots\n}\n"],"mappings":";;AAWA,SAASA,kBAAkB,QAAQ,uBAAuB;AAmB1D,OAAO,MAAMC,iBAAiB,GAAG,CAAC;EAChCC,SAAS,EAATA,UAAS,GAAG,EAAE;EACdC,UAAU;EACVC,YAAY;EACZC;AACsB,CAAC,KAA2B;EAClD,MAAMC,YAAY,GAAGN,kBAAkB,EAAa;EAEpD,MAAMO,KAAK,GAAGL,UAAS,CAACC,UAAU,CAAC;EACnC,IAAII,KAAK,EAAE;IAAA;IACT,MAAM;MAAEC,EAAE;MAAEC;IAAO,CAAC,GAAGJ,WAAW,GAC9B;MACEG,EAAE,EAAG,GAAED,KAAK,CAACG,IAAK,MAAKL,WAAW,aAAXA,WAAW,uBAAXA,WAAW,CAAEM,IAAI,CAACJ,KAAK,CAACG,IAAI,CAAE,EAAC;MAEtDD,MAAM,EAAEJ,WAAW,aAAXA,WAAW,gDAAXA,WAAW,CAAEO,MAAM,CAACL,KAAK,CAACG,IAAI,CAAC,0DAA/B,sBAAiCG,OAAO,CAAC,eAAe,EAAE,EAAE;IACtE,CAAC,GACD;MAAEL,EAAE,EAAED,KAAK,CAACG,IAAI;MAAED,MAAM,EAAEF,KAAK,CAACO;IAAM,CAAC;IAE3C,OAAOb,iBAAiB,CAAC;MACvBC,SAAS,EAATA,UAAS;MACTC,UAAU,EAAEA,UAAU,GAAG,CAAC;MAC1BC,YAAY,EAAEE,YAAY,CAACS,KAAK,CAAC;QAC/BP,EAAE;QACFC,MAAM;QACNO,OAAO,EAAE,CACP,IAAIC,KAAK,CAACC,OAAO,CAACd,YAAY,CAAC,GAAGA,YAAY,GAAG,CAACA,YAAY,CAAC,CAAC;MAEpE,CAAC,CAAC;MACFC;IACF,CAAC,CAAC;EACJ;;EAKA,IAAIY,KAAK,CAACC,OAAO,CAACd,YAAY,CAAC,EAAE;IAC/B,OAAOE,YAAY,CAACS,KAAK,CAAC;MACxBP,EAAE,EAAG,eAAcL,UAAW,EAAC;MAC/Ba,OAAO,EAAEZ;IACX,CAAC,CAAC;EACJ;EAEA,OAAOA,YAAY;AACrB,CAAC"}